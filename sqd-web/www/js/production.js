!function(){"use strict";angular.module("sqd",["ionic","ngCordova","ionic-cache-src","ngAnimate","templates","menu","welcome","blank","ngStorage"])}(),function(){"use strict";function e(e,t,n,r,o,i,a,s,c,u,l,d,f,p,m){function h(e,t){var n=t.url().split("/").pop();return""!==n?"/main/squidles/"+n:"/welcome"}var v="https://squidler.com",g="https://squidler.com";n.otherwise(h),h.$inject=["$injector","$location"],e.interceptors.push(["$rootScope","$q",function(){return{request:function(e){return e.timeout=15e3,e}}}]),o.setApi(v+"/api/1/squidle"),a.setApi(v+"/api/1/user/history"),p.setApi(v+"/api/1/user/credits"),m.setApi(v+"/api/1/user/receipts"),i.setWaitTime(1),s.setApi(v+"/api/1/support"),c.setApi(v+"/api/1/user/profile"),f.setApi(g+"/faq.json"),u.aHrefSanitizationWhitelist(/^\s*(https?|sms|mailto|twitter|whatsapp|file):/),d.set({color:"#FBAB00"}).set({expire:172800}),r.html5Mode(!0)}angular.module("sqd").config(e),e.$inject=["$httpProvider","$stateProvider","$urlRouterProvider","$locationProvider","squidlesProvider","resourcesProvider","historyProvider","emailsProvider","profilesProvider","$compileProvider","$sceProvider","$cacheSrcProvider","faqsProvider","creditsProvider","receiptsProvider"],angular.module("sqd").constant("$ionicLoadingConfig",{templateUrl:"app/components/loading/loading.html",delay:300,duration:3e4})}(),function(){"use strict";function e(e,t,n,r,o,i,a,s,c,u,l,d,f){function p(e){var t=Date.now(),n=864e5,r=24192e5;o.update("usageData","opens",{number:e.number+1,timeLastOpen:t});var i=t-(e.timeLastOpen||0)>n?!0:!1,a=t-(e.timeLastOpen||0)>r?!0:!1;return i&&l.read(void 0,{refresh:!0,silent:!0}),a&&f.read({refresh:!0,silent:!0}),u.when()}t.$state=r,t.objectKeys=Object.keys,t.history=n.viewHistory(),t.BASE="https://squidler.com",o.create("version"),o.read("version","current").then(function(){o.update("version","current","1.0.0")}).catch(function(){o.create("version","current","1.0.0")}),o.create("profiles"),o.create("squidles"),o.create("faqs","list",{}),o.create("usageData","opens",{timeLastOpen:0,number:0}),o.create("credits","number",0),o.create("auth","username","guest"),t.$on("$stateChangeError",function(e,n,o,i,a,s){if(angular.isObject(s))switch(s.code){case 401:r.go("welcome");break;case 404:r.go("welcome"),d.location.href=t.BASE+"/w/"+s.path}}),t.$on("reset",function(){r.go("welcome"),d.location.reload()}),e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1)),window.StatusBar&&StatusBar.styleDefault(),o.read("usageData","opens").then(p)})}angular.module("sqd").run(e),e.$inject=["$ionicPlatform","$rootScope","$ionicHistory","$state","stores","history","$timeout","$ionicPopup","$ionicLoading","$q","profiles","$window","faqs"]}(),function(){"use strict";function e(){}angular.module("sqd").controller("SqdController",e),e.$inject=["$state","$scope","stores","params"]}(),function(){"use strict";function e(){function e(){var e=[{sref:"main.help",title:"Help and Support"},{sref:"main.info",title:"About"}];return{items:e}}function t(){var e={prize:"Next",challenge:"Next",answer:"Lock"},t={prize:"Choose what to send",challenge:"Lock it with a question",answer:"Your answer is the key"},n={prize:"Text and links go here",challenge:"Question goes here. You can also add links to content",answer:"Let's not make it too easy for them, muhahahaha!"};return{nextText:e,panelText:t,placeholderText:n}}function n(){var e=["img/logo_orange.svg","img/logo_red.svg","img/logo_yellow.svg"];return{logos:e}}function r(){var e="img/avatar.jpg";return{defaultAvatar:e}}function o(){var e="You can paste a link to an image, animation or video - the content will be attached (jpg/png/imgur/gif/gifv/YouTube)",t="We've sent you a Squidle. It is locked (you haven't solved it yet) and it will expire in 24 hours. Tap to view, hold or swipe to share or see Squidle stats.",n="Tap here to buy Squids. Use them to get hints to Squidles you receive and to make the Squidles you send harder for your friends";return{squidles:t,create:e,credits:n}}var i={menu:e,create:t,welcome:n,squidles:r,walkthroughs:o};return i}angular.module("sqd").factory("params",e)}(),function(){"use strict";angular.module("menu",["ui.router","squidles","help","info"])}(),function(){"use strict";function e(e,n,r){r.backButton.text("").previousTitleText(!1),e.state("main",{url:"/main","abstract":!0,views:{app:{templateUrl:"app/interfaces/menu/menu.html",controller:"MenuController as menu"}},resolve:{historyReady:t}}),n.enabled(!1)}function t(){}angular.module("menu").config(e),e.$inject=["$stateProvider","$sceProvider","$ionicConfigProvider"],t.$inject=["history"]}(),function(){"use strict";function e(e,t,n,r,o,i,a,s,c,u,l,d,f){function p(){g.items=a.menu().items,m()}function m(){function e(e){g.username=e,i.read(e).then(function(e){g.avatar=e.avatar,g.name=e.name})}o.read("auth","username").then(e)}function h(){ionic.Platform.isIOS()?window.open("https://itunes.apple.com/us/app/squidler/id1133896864?ls=1&mt=8","_system","location=yes"):ionic.Platform.isAndroid()?window.open("https://play.google.com/store/apps/details?id=com.squidler","_system","location=yes"):d.alert({title:"Sorry",template:"Squidler is only currently available for Android and iOS",okType:"button-assertive"})}function v(){return f.path()}var g=this;g.items=[],g.user={},g.downloadSquidler=h,g.path=v,e.$on("$ionicView.enter",function(){var e=(c.viewHistory().backView||{}).stateName;["welcome","blank"].indexOf(e)>-1&&c.clearHistory(),c.nextViewOptions({disableAnimate:!0,expire:300})}),e.$on("profileUpdated",m),e.$on("$ionicView.enter",function(){l.canDragContent(!1)}),p()}angular.module("sqd").controller("MenuController",e),e.$inject=["$scope","$rootScope","$state","$ionicLoading","stores","profiles","params","$ionicPlatform","$ionicHistory","$localStorage","$ionicSideMenuDelegate","$ionicPopup","$location"]}(),function(){"use strict";angular.module("squidles",["ui.router"])}(),function(){"use strict";function e(e){var n=ionic.Platform.isIOS()?"squidle-ios.html":"squidle.html";e.state("main.squidle",{url:"/squidles/:squidleId",views:{main:{templateUrl:"app/components/squidles/"+n,controller:"SquidleController as squidle"}},resolve:{squidleExists:t}})}function t(e,t,n,r){return r.show(),e.read({"short":t.squidleId},{silent:!0}).then(function(){return r.hide(),n.resolve()}).catch(function(){return r.hide(),n.reject({code:404,path:t.squidleId})})}angular.module("squidles").config(e),e.$inject=["$stateProvider","$sceProvider"],t.$inject=["squidles","$stateParams","$q","$ionicLoading"],angular.module("squidles").constant("$ionicLoadingConfig",{templateUrl:"app/components/loading/loading.html",delay:300})}(),function(){"use strict";function e(e,t,n,r,o,i,a,c,u,l){function d(){function e(e){angular.forEach(g.list,function(e){a.remaining(e.expiresAt)<=0&&(i.remove("squidles",e.id,void 0,{silent:!0}),v(e.id))}),o.read().then(function(t){angular.forEach(t,function(t){var n={};n.username=t.op,n.description=t.challenge.text.value,n.id=t.short,n.avatar=e[t.op].avatar,n.name=e[t.op].name,n.sent=t.sent,n.hasAttachment="video"in t.challenge||"photo"in t.challenge,n.alreadyAnswered="prize"in t,n.expiresAt=t.expiresAt,n.timeRemaining=a.remaining(t.expiresAt),n.timeRemaining<=0?(i.remove("squidles",n.id,void 0,{silent:!0}),v(n.id)):void 0==g.listIds[n.id]?(g.list.push(n),g.listIds[n.id]=g.list.length-1):Object.assign(g.list[g.listIds[n.id]],n)}),g.startTimer()})}g.list=g.list?g.list:[],g.listIds=g.listIds?g.listIds:{},i.read("profiles").then(e)}function f(){l.alert({title:"Glad you like Squidler!",template:"Please send us a message via the help section in the menu to request an invite to download the full app",okType:"button-positive"}).then(function(){n.go("main.help")})}function p(e){n.go("main.squidle",{squidleId:e})}function m(e){return a.hourMinSec(e).string}function h(){g.timer=g.timer?g.timer:r(function(){angular.forEach(g.list,function(e){e.timeRemaining-=1,e.timeRemaining<=0&&(v(e.id),i.remove("squidles",s.id,void 0,{silent:!0}))})},1e3)}function v(e){void 0!=g.listIds[e]&&(g.list.splice(g.listIds[e],1),g.listIds={},angular.forEach(g.list,function(e,t){g.listIds[e.id]=t}))}var g=this;t.$on("$ionicView.beforeEnter",function(){d()}),t.$on("$destroy",function(){g.timer&&r.cancel(g.timer)}),g.goToSquidle=p,g.countDown=m,g.startTimer=h,g.createSquidle=f}angular.module("squidles").controller("SquidlesController",e),e.$inject=["$rootScope","$scope","$state","$interval","squidles","stores","time","params","history","$ionicPopup","$ionicListDelegate","profiles","$timeout"]}(),function(){"use strict";function e(e,t,n,r,o,i,a,s,c,u,l,d,f,p,m,h,v){function g(e){s.enableSlide(e)}function w(){"preview"==i.squidleId?o.read("preview").then(function(e){O.isPreview=!0,O.data=e.squidle,O.guess=e.squidle.answer.text.value,O.answerHeight=C(O.guess),O.toggleSwipe(O.isPreview)}):(window.addEventListener("native.keyboardshow",y),window.addEventListener("native.keyboardhide",$),O.guess="",a.show(),r.read({"short":i.squidleId}).then(function(e){a.hide(),i.squidleId=e.short;var t=d.remaining(e.expiresAt);0>=t?k():(O.data=angular.copy(e),O.answerHeight=C(O.data.answer.text.value),O.noMoreHints=-1==O.data.answer.text.value.indexOf("_")?!0:!1,O.data.prize?O.alreadyAnswered=!0:(O.data.timeRemaining=t,O.startTimer())),O.isPreview=!1,O.toggleSwipe(O.alreadyAnswered)}).catch(function(){l.nextViewOptions({historyRoot:!0}),n.go("welcome")}))}function y(){ionic.Platform.isIOS()&&(O.keyboardShow=!0)}function $(){ionic.Platform.isIOS()&&(O.keyboardShow=!1)}function q(){function t(t){a.hide(),O.validGuess=!0,f.cancel(O.timer),t.prize?(O.alreadyAnswered=!0,O.data.prize=t.prize,s.next(),O.toggleSwipe(O.alreadyAnswered),O.pause=!0,e.$broadcast("pause")):(O.validGuess=!1,u.alert({title:":-( Wrong Answer",okType:"button-assertive"}))}function c(e){404===e.details.status&&(f.cancel(O.timer),o.remove("squidles",i.squidleId).then(function(){l.nextViewOptions({historyRoot:!0}),n.go("welcome")}))}if(O.squidleForm.$valid){a.show();var d={"short":i.squidleId,guess:O.guess};r.read(d).then(t).catch(c)}else u.alert({title:"Empty guess",okType:"button-assertive"})}function b(){u.confirm({title:"Glad you like Squidler!",template:"To create your own Squidles you'll need to download our FREE app",okType:"button-energized"}).then(function(e){e&&(ionic.Platform.isIOS()?window.open("https://itunes.apple.com/us/app/squidler/id1133896864?ls=1&mt=8","_system","location=yes"):ionic.Platform.isAndroid()?window.open("https://play.google.com/store/apps/details?id=com.squidler","_system","location=yes"):u.alert({title:"Sorry",template:"Squidler is only currently available for Android and iOS",okType:"button-assertive"}))})}function S(){s.next(),O.prizeDisplayed=!0}function j(){l.goBack(),e.$on("$ionicView.afterLeave",function(){t.$broadcast("processSquide")})}function x(t){O.prizeDisplayed=1==t?!0:!1,e.$broadcast("pause")}function P(e){return d.hourMinSec(e).string}function A(){O.timer=O.timer?O.timer:f(function(){O.data.timeRemaining-=1,O.data.timeRemaining<=0&&k()},1e3)}function k(){o.remove("squidles",i.squidleId),O.outOfTime=u.alert({title:"Sorry, you've run out of time :-(",okType:"button-assertive"}),O.outOfTime.then(function(){l.nextViewOptions({historyRoot:!0}),n.go("welcome")}),p(function(){O.outOfTime.close(),l.nextViewOptions({historyRoot:!0}),n.go("welcome")},2e3),f.cancel(O.timer)}function T(){o.remove("squidles",i.squidleId,["prize"]),O.alreadyAnswered=!1,O.toggleSwipe(!1),w()}function I(e){try{m.ready(function(){h.copy(e).then(function(){u.alert({title:"Text copied :-)",okType:"button-assertive"})},function(){u.alert({title:"Failed to copy text :-(",okType:"button-assertive"})})})}catch(t){u.alert({title:"Failed to copy Text :-(",okType:"button-assertive"})}}function C(e){var t;if(e&&""!=e){var n=(e.length/17>>0)+1,r=Math.max(n,2.5);t={height:r.toString()+"em"}}else t={height:"2.5em"};return t}function R(){v.$getByHandle("fullScreenImage").zoomTo(1),v.$getByHandle("fullScreenImage").scrollTop()}function B(){u.confirm({title:"Glad you like Squidler!",template:"To get hints you'll need to download our FREE app",okType:"button-energized"}).then(function(e){e&&(ionic.Platform.isIOS()?window.open("https://itunes.apple.com/us/app/squidler/id1133896864?ls=1&mt=8","_system","location=yes"):ionic.Platform.isAndroid()?window.open("https://play.google.com/store/apps/details?id=com.squidler","_system","location=yes"):u.alert({title:"Sorry",template:"Squidler is only currently available for Android and iOS",okType:"button-assertive"}))})}function D(){n.go("main.help",{message:"Inappropriate content on Squidle with id "+i.squidleId})}var O=this;O.data={},O.alreadyAnswered=!1,O.prizeDisplayed=!1,O.validGuess=!0,O.adjustForIos=ionic.Platform.isIOS()?{top:"20px"}:{},O.fullScreen={height:window.innerHeight-96+"px",position:"relative"},O.toggleSwipe=g,O.makeGuess=q,O.createSquidle=b,O.showPrize=S,O.processSquidle=j,O.slideHasChanged=x,O.countDown=P,O.startTimer=A,O.lock=T,O.copyText=I,O.resetFullScreenImage=R,O.getHint=B,O.report=D,e.$on("$destroy",function(){O.timer&&f.cancel(O.timer)}),e.$on("submit-guess",function(){O.makeGuess()}),c.fromTemplateUrl("app/components/squidles/fullscreenModal.html",{scope:e}).then(function(e){O.fullscreen=e}),O.openFullscreen=function(){O.fullscreen.show(),O.fullScreenOpen=!0},O.closeFullscreen=function(){O.fullscreen.hide().then(function(){O.fullScreenOpen=!1,O.resetFullScreenImage()})},e.$on("$destroy",function(){O.fullscreen.remove(),window.removeEventListener("native.keyboardshow",y),window.removeEventListener("native.keyboardhide",$)}),w()}angular.module("squidles").controller("SquidleController",e),e.$inject=["$scope","$rootScope","$state","squidles","stores","$stateParams","$ionicLoading","$ionicSlideBoxDelegate","$ionicModal","$ionicPopup","$ionicHistory","time","$interval","$timeout","$ionicPlatform","$cordovaClipboard","$ionicScrollDelegate","$q"]}(),function(){function e(){function e(e,t){function n(){var e=t[0].contentWindow;e.postMessage('{"event":"command","func":"stopVideo","args":""}',"*")}e.$on("pause",n)}var t={restrict:"A",link:e};return t}angular.module("squidles").directive("sqdPause",e),e.$inject=[]}(),function(){"use strict";angular.module("info",["ui.router"])}(),function(){"use strict";function e(e){e.state("main.info",{url:"/info",views:{main:{templateUrl:"app/components/info/info.html",controller:"InfoController as info"}}})}angular.module("info").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,n){function r(){n.read("version","current").then(function(e){a.version=e}),a.logos=e.welcome().logos;var t=a.logos.length;a.logoIndex=Math.random()/(1/parseFloat(t))>>0,a.logo=a.logos[a.logoIndex]}function o(){var e=a.logos.length;a.logoIndex=(a.logoIndex+1)%e,a.logo=a.logos[a.logoIndex]}function i(e){t.scrollTo(0,(window.innerHeight-44)*e,!0)}var a=this;a.changeLogo=o,a.pageDown=i,r()}angular.module("info").controller("InfoController",e),e.$inject=["params","$ionicScrollDelegate","stores"]}(),function(){"use strict";angular.module("help",["ui.router"])}(),function(){"use strict";function e(e){e.state("main.help",{url:"/help?message&email&name",views:{main:{templateUrl:"app/components/help/help.html",controller:"HelpController as help"}}})}angular.module("help").config(e),e.$inject=["$stateProvider"],angular.module("help").constant("$ionicLoadingConfig",{templateUrl:"app/components/loading/loading.html",delay:300})}(),function(){"use strict";function e(e,t,n,r,o,i,a){function s(){f.question={name:"",email:"",message:""},i.read().then(function(e){f.FAQs=e}),t.fromTemplateUrl("app/components/help/askQuestionModal.html",{scope:e}).then(function(e){f.askQuestion=e})}function c(){var t={refresh:!0};i.read(t).then(function(t){f.FAQs=t,e.$broadcast("scroll.refreshComplete")}).catch(function(){e.$broadcast("scroll.refreshComplete")})}function u(e){f.shownFAQ=f.isFAQShown(e)?null:e}function l(e){return f.shownFAQ===e}function d(){if(f.helpForm.$valid)n.show(),o.create(f.question).then(function(){n.hide(),f.askQuestion.hide(),r.alert({title:"Thanks!",template:"We've received your message",okType:"button-energized"}),f.askQuestion.remove().then(function(){s()})});else{var e="";angular.forEach(f.helpForm.$error,function(t,n){switch(n){case"required":e="You need to complete the form";break;case"email":e="Sorry, you've not entered a valid email address";break;case"maxlength":e="Sorry, you've entered more than the 2000 character limit"}}),r.alert({title:"Oops!",template:e,okType:"button-assertive"})}}var f=this;f.toggleFAQ=u,f.isFAQShown=l,f.submitQuestion=d,f.refresh=c,s(),e.$on("$ionicView.enter",function(){a.message&&(f.question.message=a.message,f.askQuestion.show())})}angular.module("help").controller("HelpController",e),e.$inject=["$scope","$ionicModal","$ionicLoading","$ionicPopup","emails","faqs","$stateParams"]}(),function(){"use strict";angular.module("welcome",["ui.router"])}(),function(){"use strict";function e(e){e.state("welcome",{url:"/welcome",views:{app:{templateUrl:"app/components/welcome/welcome.html",controller:"WelcomeController as welcome"}}})}angular.module("welcome").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,n,r,o,i,a,s,c,u,l,d,f,p,m){function h(){b.logos=d.welcome().logos;var e=b.logos.length;b.logoIndex=Math.random()/(1/parseFloat(e))>>0,b.logo=b.logos[b.logoIndex]}function v(){o.next()}function g(){o.previous()}function w(e){b.activeSlide=e}function y(){ionic.Platform.isIOS()?window.open("https://itunes.apple.com/us/app/squidler/id1133896864?ls=1&mt=8","_system","location=yes"):ionic.Platform.isAndroid()?window.open("https://play.google.com/store/apps/details?id=com.squidler","_system","location=yes"):c.alert({title:"Sorry",template:"Squidler is only currently available for Android and iOS",okType:"button-assertive"})}function $(e){m.scrollTo(0,window.innerHeight*e,!0)}function q(){var e=b.logos.length;b.logoIndex=(b.logoIndex+1)%e,b.logo=b.logos[b.logoIndex]}var b=this;b.next=v,b.previous=g,b.slideChanged=w,b.changeLogo=q,b.downloadSquidler=y,b.pageDown=$,h()}angular.module("welcome").controller("WelcomeController",e),e.$inject=["$scope","$rootScope","$state","$stateParams","$ionicSlideBoxDelegate","$ionicModal","$timeout","$ionicHistory","$ionicPopup","history","$ionicLoading","params","stores","squidles","$ionicScrollDelegate"]}(),function(){"use strict";angular.module("blank",["ui.router"])}(),function(){"use strict";function e(e){e.state("blank",{url:"/blank",views:{app:{templateUrl:"app/components/blank/blank.html"}}})}angular.module("blank").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i,a,s,c){function u(t,c){function u(t){var n=t.answer.text.value.toLowerCase().trim();return t.answer.text.value=n,e.when(t)}function l(t){function n(t){return(t.prize.photo||{}).uploaded&&s.push({data:t.prize.photo.value,label:"prize"}),(t.challenge.photo||{}).uploaded&&s.push({data:t.challenge.photo.value,label:"challenge"}),e.when(s)}function r(e){return o.create(e)}function i(n){for(var r=0;r<n.length;r++)t[s[r].label].photo.value=n[r].url;return e.when(t)}var a=(t.prize.photo||{}).uploaded||(t.challenge.photo||{}).uploaded,s=[];return a?n(t).then(r).then(i):e.when(t)}function d(e){function t(e){var t=e.short,n=e.op;return delete e.prize,e.sent=!0,e.stats={},i.remove("preview","squidle"),i.create("preview","squidle",{}),i.remove("tempSquidle","prize"),i.create("tempSquidle","prize",{text:""}),i.remove("tempSquidle","challenge"),i.create("tempSquidle","challenge",{text:""}),i.remove("tempSquidle","answer"),i.create("tempSquidle","answer",{text:""}),a.read(e.op).then(function(){e.op=n,angular.forEach(e.challenge,function(t,n){e.challenge[n]={value:t}}),angular.forEach(e.prize,function(t,n){e.prize[n]={value:t}}),e.answer={text:{value:e.answer}},i.create("squidles",t,e),f.resolve(e)})}return e=e.constructor===Array?e[0]:e,r.create("squidle",n,e).then(t)}var f=e.defer(),c=void 0!==c?c:{},p=void 0!==c.silent?c.silent:!1;return e.all([u(t),l(t)]).then(d).catch(s.create("Problem creating your Squidle",{toBeRejected:{promise:f},silent:p})),f.promise}function l(t,o){function c(t){return t.guess=t.guess.toLowerCase().trim(),e.when(t)}function u(t){function o(t){var n=t.short;return angular.forEach(t.prize,function(e,n){t.prize[n]={value:e}}),i.update("squidles",n,t),f.resolve(t),e.when(t)}function a(t){return 403==t.details.status?(f.resolve(t),e.when()):(404===t.details.status&&(t.details.data.error="Sorry, this Squidle was deleted by its creator"),f.reject(t),e.reject(t))}return r.action("solve","squidle",n,t.short,{guess:t.guess}).then(o,a)}function l(){return i.read("squidles").then(function(t){return f.resolve(t),e.when(t)})}function d(t){function o(t){return f.resolve(t),e.when(t)}function s(){function t(t){return angular.forEach(t.challenge,function(e,n){t.challenge[n]={value:e}}),angular.forEach(t.prize,function(e,n){t.prize[n]={value:e}}),t.answer={text:{value:t.answer}},i.read("auth","username").then(function(n){return t.sent=t.op==n,e.when(t)})}function o(e){return a.read(e.op).then(function(){var t=e.short;e.stats={},i.create("squidles",t,e),f.resolve(e)})}return r.read("squidle",n,c).then(t).then(o)}var c=t.short;return c?i.read("squidles",c).then(o,s):e.reject("No squidle id presented")}var f=e.defer(),o=void 0!==o?o:{},p=void 0!==o.silent?o.silent:!1;return t?t.guess?c(t).then(u).catch(s.create("Problem getting your prize",{toBeRejected:{promise:f},silent:p})):d(t).catch(s.create("Problem getting your Squidle",{toBeRejected:{promise:f},silent:p})):l().catch(s.create("Problem getting your Squidles",{toBeRejected:{promise:f},silent:p})),f.promise}function d(t,o,a){function u(t){function n(e,t){var n=new Date;switch(e.toLowerCase()){case"minute":n.setTime(n.getTime()+6e4*t),n=Math.floor(n.getTime()/1e3)}return n}var r=t.expiresAt.interval,o=t.expiresAt.units;return t.expiresAt=n(r,o),e.when(t)}function l(t){return t.hintsOn=t.hintsOn?1:0,e.when(t)}function d(e){function t(e){return delete e.prize,angular.forEach(e.challenge,function(t,n){e.challenge[n]={value:t}}),e.answer={text:{value:e.answer}},i.update("squidles",a,e)}function o(){return c.read({refresh:!0})}var a=e.short;return delete e.short,r.update("squidle",n,a,e).then(t).then(o)}var a=void 0!==a?a:{},f=void 0!==a.silent?a.silent:!1;switch(o.toLowerCase()){case"expiry":return u(t).then(d).catch(s.create("Problem updating your Squidle",{silent:f}));case"hint":return l(t).then(d).catch(s.create("Problem updating your Squidle",{silent:f}))}}function f(t,o){function a(){return i.remove("squidles",u)}var o=void 0!==o?o:{},c=void 0!==o.silent?o.silent:!1,u=t.id,l=t.sent;return u?l?r.destroy("squidle",n,u).then(a).catch(s.create("Problem removing your Squidle",{silent:c})):a():e.reject("No squidle id presented")}function p(t,o){function a(n){return i.update("squidles",t,n),c.resolve(n.updatable),e.when()}var c=e.defer(),o=void 0!==o?o:{},u=void 0!==o.silent?o.silent:!1;return r.read("squidle",n+"/updatable",t).then(a).catch(s.create("Problem reading update status of your Squidle",{toBeRejected:{promise:c},silent:u})),c.promise}function m(t,o){function a(n){n.answer={text:{value:n.answer}},i.update("squidles",t,n).then(function(){return e.when(n)})}function u(){return c.read({refresh:!0})}var o=void 0!==o?o:{},l=void 0!==o.silent?o.silent:!1;return r.read("squidle",n+"/hint",t).then(a).then(u).catch(s.create("Problem getting a hint for this Squidle",{silent:l}))}var h={create:u,read:l,update:d,remove:f,updatable:p,getHint:m};return h}var n;t.$inject=["$q","$rootScope","resources","files","stores","profiles","exceptions","credits"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("squidles",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i,a){function s(s,c,u,l){function d(e){var t=(new Date).getTime()-m;n>=t?r(function(){e.data.success?p.resolve(e.data[s]):p.reject(e.data.error)},n-t):e.data.success?p.resolve(e.data[s]):p.reject(e.data.error)}var f,p=e.defer(),m=(new Date).getTime(),h={},v={},l=void 0!==l?l:{},g=void 0!==l.silent?l.silent:!0;if(l.formData){v={transformRequest:angular.identity,headers:{"Content-Type":void 0}};var f=new FormData;f.append(s,u)}else h[s]=u,f=u;return a.ready(function(){try{i.isOffline()?o.create("No internet connection",{toBeRejected:{promise:p,message:"No internet connection"},silent:g})(new Error("No internet connection")):t.post(c+"/create",f,v).then(d).catch(o.create("Cannot create "+s+" on the server",{toBeRejected:{promise:p,message:"resources.create fail"},silent:g}))}catch(e){t.post(c+"/create",f,v).then(d).catch(o.create("Cannot create "+s+" on the server",{toBeRejected:{promise:p,message:"resources.create fail"},silent:g}))}}),p.promise}function c(s,c,u,l,d){function f(e){var t=(new Date).getTime()-m;n>=t?r(function(){e.data.success?p.resolve(e.data[s]):p.reject(e.data.error)},n-t):e.data.success?p.resolve(e.data[s]):p.reject(e.data.error)}var p=e.defer(),m=(new Date).getTime(),d=void 0!==d?d:{},h=void 0!==d.silent?d.silent:!0,v=u?c+"/"+u:c;delete d.silent;var g=d;return g.params=l,a.ready(function(){try{i.isOffline()?o.create("No internet connection",{toBeRejected:{promise:p,message:"No internet connection"},silent:h})(new Error("No internet connection")):t.get(v,g).then(f).catch(o.create("Cannot find "+s+" on the server",{toBeRejected:{promise:p,message:"resources.read fail"},silent:h}))}catch(e){t.get(v,g).then(f).catch(o.create("Cannot find "+s+" on the server",{toBeRejected:{promise:p,message:"resources.read fail"},silent:h}))}}),p.promise}function u(s,c,u,l,d){function f(e){var t=(new Date).getTime()-h;n>=t?r(function(){e.data.success?m.resolve(e.data[s]):m.reject(e.data.error)},n-t):e.data.success?m.resolve(e.data[s]):m.reject(e.data.error)}var p,m=e.defer(),h=(new Date).getTime(),v={},d=void 0!==d?d:{},g=void 0!==d.silent?d.silent:!0;return v[s]=l,p=l,a.ready(function(){try{i.isOffline()?o.create("No internet connection",{toBeRejected:{promise:m,message:"No internet connection"},silent:g})(new Error("No internet connection")):t.post(c+"/update/"+u,p).then(f).catch(o.create("Cannot update "+s+" on the server",{toBeRejected:{promise:m,message:"resources.update fail"},silent:g}))}catch(e){t.post(c+"/update/"+u,p).then(f).catch(o.create("Cannot update "+s+" on the server",{toBeRejected:{promise:m,message:"resources.update fail"},silent:g}))}}),m.promise}function l(s,c,u,l){function d(e){var t=(new Date).getTime()-p;n>=t?r(function(){e.data.success?f.resolve(e.data[s]):f.reject(e.data.error)},n-t):e.data.success?f.resolve(e.data[s]):f.reject(e.data.error)}var f=e.defer(),p=(new Date).getTime(),l=void 0!==l?l:{},m=void 0!==l.silent?l.silent:!0;return a.ready(function(){try{i.isOffline()?o.create("No internet connection",{toBeRejected:{promise:f,message:"No internet connection"},silent:m})(new Error("No internet connection")):t.post(c+"/delete/"+u).then(d).catch(o.create("Cannot destroy "+s+" on the server",{toBeRejected:{promise:f,message:"resources.destroy fail"},silent:m}))}catch(e){t.post(c+"/delete/"+u).then(d).catch(o.create("Cannot destroy "+s+" on the server",{toBeRejected:{promise:f,message:"resources.destroy fail"},silent:m}))}}),f.promise}function d(s,c,u,l,d,f){function p(e){var t=(new Date).getTime()-v;n>=t?r(function(){e.data.success?h.resolve(e.data[c]):h.reject(e.data.error)},n-t):e.data.success?h.resolve(e.data[c]):h.reject(e.data.error)}var m,h=e.defer(),v=(new Date).getTime(),g={},w={},f=void 0!==f?f:{},y=void 0!==f.silent?f.silent:!0,$=l?u+"/"+s+"/"+l:u+"/"+s;return f.formData?(w={transformRequest:angular.identity,headers:{"Content-Type":void 0}},m=new FormData,m.append(c,d)):(g[c]=d,m=d),a.ready(function(){try{i.isOffline()?o.create("No internet connection",{toBeRejected:{promise:h,message:"No internet connection"},silent:y})(new Error("No internet connection")):t.post($,m,w).then(p).catch(o.create("Cannot "+s+" "+c+" on the server",{toBeRejected:{promise:h,message:"resources.action fail"},silent:y}))}catch(e){t.post($,m,w).then(p).catch(o.create("Cannot "+s+" "+c+" on the server",{toBeRejected:{promise:h,message:"resources.action fail"},silent:y}))}}),h.promise}var f={create:s,read:c,update:u,destroy:l,action:d};return f}var n;t.$inject=["$q","$http","$timeout","exceptions","$cordovaNetwork","$ionicPlatform"];var r={setWaitTime:e,$get:t};return r}angular.module("sqd").provider("resources",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i){function a(i){function a(){function o(t){return r.update("credits","number",t.number),e.when(t.number)}return r.read("auth","username").then(function(e){return t.read("credits",n,e).then(o)})}var i=void 0!==i?i:{},s=i.refresh,c=void 0!==i.silent?i.silent:!1;return s?a().catch(o.create("Problem getting your credits",{silent:c})):r.read("credits","number").catch(a).catch(o.create("Problem getting your credits",{silent:c}))}function s(e){function s(){return inAppPurchase.buy(d)}function c(e){return p.receipt=e,p.receipt.os=f,r.create("credits","pending",{purchase:p}).then(function(){return inAppPurchase.consume(e.productType,e.receipt,e.signature)})}function u(){function e(){return r.remove("credits","pending")}function o(){return a({refresh:!0})}function s(){return i.read({refresh:!0})}return r.update("credits","pending",{state:"consumed"}).then(function(){return t.create("credits",n,p).then(e).then(o).then(s)})}var e=void 0!==e?e:{},l=void 0!==e.silent?e.silent:!1,d="credits_100000",f=ionic.Platform.isAndroid()?"android":ionic.Platform.isIOS()?"ios":null,p={receipt:{}};try{return inAppPurchase.getProducts([d]).then(s).then(c).then(u).catch(o.create("Problem purchasing your credits",{silent:l}))}catch(m){return o.create("Problem purchasing your credits",{silent:l})(m)}}function c(s){function c(){return t.create("credits",n,f)}function u(){return r.remove("credits","pending")}function l(){return a({refresh:!0})}function d(){return i.read({refresh:!0})}var f,s=void 0!==s?s:{},p=void 0!==s.silent?s.silent:!1;return r.read("credits","pending").then(function(t){return f=t.purchase,"consumed"===t.state?e.when():inAppPurchase.consume(f.productType,f.receipt,f.signature)}).then(c).then(u).then(l).then(d).catch(o.create("Problem verifying your last purchase",{silent:p}))}var u={read:a,create:s,verify:c};return u}var n;t.$inject=["$q","resources","stores","exceptions","receipts"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("credits",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i){function a(o){function a(){function o(t){for(var n,o=0;o<t.length;o++)n=new Date(t[o].date).getTime(),r.create("receipts",n.toString(),t[o],{silent:!0});return e.when(t)}return r.read("auth","username").then(function(e){return t.read("receipts",n,e).then(o)})}var o=(e.defer(),void 0!==o?o:{}),s=o.refresh,c=void 0!==o.silent?o.silent:!1;return s?a().catch(i.create("Problem getting your receipts",{silent:c})):r.read("receipts").catch(a).catch(i.create("Problem getting your receipts",{silent:c}))}var s={read:a};return s}var n;t.$inject=["$q","resources","stores","profiles","exceptions"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("receipts",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e,t,n){function r(r,o,i,a){var s=e.defer(),a=void 0!==a?a:{},c=void 0!==a.silent?a.silent:!1;try{if(t[r]=t[r]?t[r]:{},o){var u=t[r][o];null!==u&&"object"==typeof u?angular.forEach(i,function(e,t){u[t]=void 0!==u[t]?u[t]:e}):void 0===u&&(t[r][o]=i)}s.resolve(r+" with id= "+o+" successfully saved to local storage")}catch(l){n.create("Cannot store "+r+" with id "+o,{toBeRejected:{promise:s,message:"stores.create error"},silent:c})(l)}return s.promise}function o(n,r,o){{var i,a,s=e.defer(),o=void 0!==o?o:{};void 0!==o.silent?o.silent:!1}try{if(i=r?t[n][r]:t[n],!i)throw"NA";
a=angular.copy(i),s.resolve(a)}catch(c){s.reject("Cannot read "+n+" with id "+r+". Data not in storage")}return s.promise}function i(r,o,i,a){var s=e.defer(),a=void 0!==a?a:{},c=void 0!==a.silent?a.silent:!1;try{var u=t[r][o];if(null!==u&&"object"==typeof u)angular.forEach(i,function(e,t){u[t]=e}),s.resolve(u);else{if(null===u||void 0===u)throw"NA";t[r][o]=i,s.resolve(u)}}catch(l){n.create("Cannot update "+r+" with id "+o+". Data not in storage",{toBeRejected:{promise:s,message:"stores.update error"},silent:c})(l)}return s.promise}function a(r,o,i,a){var s=e.defer(),a=void 0!==a?a:{},c=void 0!==a.silent?a.silent:!1;if(r)try{var u=t[r];if(u&&o){if(u=t[r][o],!u)throw"NA";i?angular.forEach(i,function(e){delete u[e]}):delete t[r][o],s.resolve("Entries from "+r+" with id= "+o+" successfully deleted from the local storage")}else t[r]={},s.resolve()}catch(l){n.create("Cannot delete entries from "+r+" with id "+o+". Data not in storage",{toBeRejected:{promise:s,message:"stores.destroy error"},silent:c})(l)}else t.$reset(),s.resolve();return s.promise}var s={create:r,read:o,update:i,remove:a};return s}e.$inject=["$q","$localStorage","exceptions"];var t={$get:e};return t}angular.module("sqd").provider("stores",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n,r,o,i){function a(a,s){var c,s=void 0!==s?s:{},u=(s.toBeRejected||{}).promise,l=(s.toBeRejected||{}).message,d=void 0!==s.silent?s.silent:!1;return function(s){if(t.hide(),!d){var f="<br><br><details><summary>Details</summary>"+JSON.stringify(s)+"</details>";"string"==typeof s?c=s:"object"==typeof s&&(c=s instanceof Error?s.message+f:s.details instanceof Error?s.details.message+f:null===s.details.data?"There appears to be a connection problem"+f:((s.details.data||{}).error||"")+f),n.alert({title:a,template:c,okType:"button-assertive"})}try{o.ready(function(){i.copy(JSON.stringify(s))})}catch(p){}return e.log=e.log?e.log:[],e.log.push(s),u?void u.reject({message:l,details:s}||""):r.reject()}}var s={create:a};return s}angular.module("sqd").factory("exceptions",e),e.$inject=["$rootScope","$ionicLoading","$ionicPopup","$q","$ionicPlatform","$cordovaClipboard"]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i){function a(a){function s(){return o.read("auth","username")}function c(){return o.read("squidles").then(function(e){return f=e,o.remove("squidles")})}function u(e){return t.read("history",n,e).catch(d)}function l(t){function n(t){return p.resolve(t),e.when(t)}var o=[];if(t){for(var i=0;i<t.length;i++)o.push(r.read({"short":t[i]},{silent:!0}));return e.all(o).then(n,d)}return p.resolve(),e.when()}function d(t){return angular.forEach(f,function(e,t){o.create("squidles",t,e)}),e.reject(t)}var f,p=e.defer(),a=void 0!==a?a:{},m=void 0!==a.silent?a.silent:!1;return a.refresh?c().then(s).then(u).then(l).catch(i.create("Problem getting your Squidles history",{toBeRejected:{promise:p,message:"history.read error"},silent:m})):s().then(u).then(l).catch(i.create("Problem getting your Squidles history",{toBeRejected:{promise:p,message:"history.read error"},silent:m})),p.promise}var s={read:a};return s}var n;t.$inject=["$q","resources","squidles","stores","exceptions"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("history",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r){function o(o,i){function a(t){function n(e){for(var t=atob(e.split(",")[1]),n=[],r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}for(var r=0;r<t.length;r++)t[r].data=n(t[r].data);return e.when(t)}function s(r){function o(t){return c.resolve(t),e.when(t)}for(var i=[],a=0;a<r.length;a++)i.push(t.create("file",n,r[a].data,{formData:!0}));return e.all(i).then(o)}var c=e.defer(),i=void 0!==i?i:{},u=void 0!==i.silent?i.silent:!1;return a(o).then(s).catch(r.create("Problem processing your files",{toBeRejected:{promise:c,message:"files.create error"},silent:u})),c.promise}var i={create:o};return i}var n;t.$inject=["$q","resources","exceptions"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("files",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r){function o(o,i){function a(){return s.resolve({success:!0}),e.when({success:!0})}var s=e.defer(),i=void 0!==i?i:{},c=void 0!==i.silent?i.silent:!1;return t.create("email",n,o).then(a).catch(r.create("Problem sending your support email",{toBeRejected:{promise:s},silent:c})),s.promise}var i={create:o};return i}var n;t.$inject=["$q","resources","exceptions"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("emails",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o,i,a){function s(o,a){function s(){function i(n){return t.create("profiles",o,n),e.when(n)}return r.read("profile",n,o).then(i)}function c(i){function a(n){var r={};return angular.forEach(n,function(e,n){t.update("profiles",s[n],e),r[s[n]]=e}),e.when(r)}var s=o?[o]:Object.keys(i),c=[];return 0!=s.length?(angular.forEach(s,function(e){c.push(r.read("profile",n,e))}),e.all(c).then(a)):e.when()}var a=void 0!==a?a:{},u=a.refresh,l=void 0!==a.silent?a.silent:!1;return u?t.read("profiles",o).then(c).catch(i.create("Problem reading all profiles",{silent:l})):t.read("profiles",o).catch(s).catch(i.create("Problem reading profile",{silent:l}))}function c(s,c,u){function l(t){function n(t){return s.push({data:t.avatar,label:"avatar"}),e.when(s)}function r(e){return o.create(e)}function i(n){for(var r=0;r<n.length;r++)t[s[r].label]=n[r].url;return e.when(t)}var a=t.avatar?!0:!1,s=[];return a?n(t).then(r).then(i):e.when(t)}function d(e){function o(e){return t.update("profiles",s,e).then(function(){f.resolve(e),a.$broadcast("profileUpdated")})}return r.update("profile",n,s,e).then(o)}var f=e.defer(),u=void 0!==u?u:{},p=void 0!==u.silent?u.silent:!1;return l(c).then(d).catch(i.create("Problem updating your profile",{toBeRejected:{promise:f},silent:p})),f.promise}var u={read:s,update:c};return u}var n;t.$inject=["$q","stores","resources","files","exceptions","$rootScope"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("profiles",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){var t=(e/60>>0)/60>>0,n=0==t?"":t+"h ",r=(e/60>>0)%60,o=0==r?"":r+"m ",i=(e||0)%60,a=0==i?"":i+"s ";return{string:n+o+a,array:[t,r,i]}}function t(e){var t=e-Math.round(Date.now()/1e3);return t}var n={hourMinSec:e,remaining:t};return n}angular.module("sqd").factory("time",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){n=e}function t(e,t,r,o){function i(i){function a(){return r.read("faqs","list").then(function(e){return c=e,r.remove("faqs")})}function s(){function o(t){return r.create("faqs","list",t),u.resolve(t),e.when(t)}function i(t){return r.create("faqs","list",c),e.reject(t)}return t.read("faqs",n,void 0,void 0,{headers:{"Cache-Control":"no-cache"}}).then(o,i)}var c,u=e.defer(),i=void 0!==i?i:{},l=void 0!==i.silent?i.silent:!1;return i.refresh?(a().then(s).catch(o.create("Problem reading the FAQs",{toBeRejected:{promise:u,message:"faq.read error"},silent:l})),u.promise):r.read("faqs","list").catch(o.create("Problem reading the FAQs",{toBeRejected:{promise:u,message:"faq.read error"},silent:l}))}var a={read:i};return a}var n;t.$inject=["$q","resources","stores","exceptions"];var r={setApi:e,$get:t};return r}angular.module("sqd").provider("faqs",e),e.$inject=[]}(),function(){function e(){function e(e,t,n,r){r.$parsers.push(function(e){return e=e.replace(/ /g,""),r.$setViewValue(e),r.$render(),e})}var t={restrict:"A",link:e,require:"ngModel"};return t}angular.module("sqd").directive("noSpaces",e),e.$inject=[]}(),function(){function e(e){function t(e,t){var n=t.textarea?"app/shared/sqdInput/sqdTextArea.html":"app/shared/sqdInput/sqdInput.html";return n}function n(t,n){t.$watch("text",function(e){void 0!=e&&("object"==typeof t.model?t.model.text=e:t.model=e)}),t.$watch("model",function(e){void 0!=e&&(t.text="object"==typeof t.model?e.text:e)},!0),t.enterSubmit&&n.bind("keydown",function(r){var o=r.keyCode||r.which;13===o&&(r.shiftKey||(r.preventDefault(),n.find(t.textarea?"textarea":"input")[0].blur(),t.focus=!1,e.$broadcast("submit-"+t.enterSubmit)))})}var r={restrict:"E",templateUrl:t,replace:!0,scope:{type:"@",placeholder:"@",model:"=",ngReadonly:"@",valid:"=",name:"@",form:"=",textarea:"@",colour:"@",background:"@",links:"@",sqdRequired:"@",maxlength:"@",nospaces:"@",checkUsername:"@",enterSubmit:"@"},link:n,controller:"SqdInputController"};return r}angular.module("sqd").directive("sqdInput",e),e.$inject=["$rootScope"]}(),function(){function e(e){function t(){e.text="object"==typeof e.model?e.model.text:e.model}function n(){e.focus&&"false"==e.ngReadonly&&(e.text="",e.form&&e.form[e.name].$setDirty())}function r(){e.form&&""!=e.text&&e.form[e.name].$validate()}e.clickAction=n,e.validateForm=r,t()}angular.module("sqd").controller("SqdInputController",e),e.$inject=["$scope"]}(),function(){function e(){function e(e,t,n){n.$observe("letterFrom",function(){e.letter=n.letterFrom.charAt(0).toUpperCase();var t=e.letter.charCodeAt()-64,r=7>=t?"#FBAB00":14>=t?"#FF6B01":"#FF2A01";e.colour={"background-color":r}})}var t={restrict:"E",templateUrl:"app/shared/sqdAvatar/sqdAvatar.html",replace:!0,scope:{src:"@",letterFrom:"@"},link:e,controller:"SqdAvatarController"};return t}angular.module("sqd").directive("sqdAvatar",e),e.$inject=[]}(),function(){function e(){function e(){}e()}angular.module("sqd").controller("SqdAvatarController",e),e.$inject=["$scope"]}(),function(){function e(e){function t(){function t(t,r,o){if(n++,!(n>=10)){var i=t.$eval(o.directiveIf);angular.forEach(i,function(e,n){var r=t.$eval(e);r===!1?o.$set(n,null):o.$set(n,!0)}),o.$set("directiveIf",null);{e(r)(t)}n=0}}function r(){}var o={pre:t,post:r};return o}var n=0,r={restrict:"A",priority:100,terminal:!0,compile:t};return r}angular.module("sqd").directive("directiveIf",e),e.$inject=["$compile"]}();